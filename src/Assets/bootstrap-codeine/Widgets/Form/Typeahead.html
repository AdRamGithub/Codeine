<js>:bower/typeahead.js/dist/typeahead.bundle</js>
<js>:bower/handlebars/handlebars.min</js>
<cssrun>
span.twitter-typeahead
{
    margin-top: 4px;
    width : 100%;
}

.form-inline span.twitter-typeahead
{
    margin-top: 4px;
}

/* dropdown suggestion menu */
.tt-menu
{
    width              : 300px;
    max-height         : 340px;
    overflow-x         : hidden;
    overflow-y         : auto;

    margin-top         : 0;
    padding            : 0;

    background-color   : #ffffff;
    border             : 1px solid #cccccc;
    border-top         : none;
    -webkit-box-shadow : 0 5px 10px rgba(0, 0, 0, .1);
    -moz-box-shadow    : 0 5px 10px rgba(0, 0, 0, .1);
    box-shadow         : 0 5px 10px rgba(0, 0, 0, .1);
}

/* individual suggestions */
.tt-suggestion
{
    margin  : 0;
    padding : 5px 10px;
    cursor  : pointer;
}

/* active/:hover suggestion */
.tt-suggestion:hover
{
    cursor           : pointer;
    background-color : #333333;
    color            : white;
}

.tt-hint
{
    display : none;
    color   : #999999;
}

.tt-suggestion p
{
    margin : 2px 0;
}

.tt-dataset .alert
{
    margin: 0;
}
</cssrun>
<div class="form-group">
    <div class="input-group">
        <if value="<k>NoLabel</k>" neq="1">
            <label for="<k>Name</k>"> <l><k>Label</k></l>: <if value="<k>Required</k>" eq="1"><span class="required-star">*</span></if></label>
        </if>
        <block>
            <span class="input-group-addon"><k>Prefix</k></span>
        </block>
        <k>HTML</k>
        <block>
            <span class="input-group-addon"><k>Postfix</k></span>
        </block>
        <input class="form-control" type="hidden" name="<k>Name</k>" id="<k>ID</k>_hidden" value="<k>HValue</k>"/>

    </div>
    <if value="<k>Help</k>" eq="1">
        <div class="help-block"><l><k>Entity</k>.Help:<k>Key</k></l></div>
    </if>
</div>

<jsrun>
    var dataset<k>ID</k> = new Bloodhound(
    {
        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('ID'),
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: {
            url: '<k>Typeahead.Remote</k>%QUERY',
            wildcard: '%QUERY'
        }
    });

    dataset<k>ID</k>.initialize();

    $('#<k>ID</k>').typeahead(null, {
      name: 'dataset<k>ID</k>',
      limit: 25,
      displayKey: 'Title',
      templates:
      {
            empty:
            [
                '<div class="alert alert-warning">',
                    'Пока ничего не найдено',
                '</div>'
            ].join('\n'),
            suggestion: Handlebars.compile(
                         '<div class="media">'
                        +'<div class="media-body">'
                        +'<div class="media-heading">{{Title}}</div>'
                        +'</div>'),
      },
      source: dataset<k>ID</k>.ttAdapter()
    }).on('typeahead:selected', function(e, datum)
    {
        $('#<k>ID</k>_hidden').val(datum.ID);
    }).on('typeahead:autocomplete', function (e)
    {
        $('#<k>ID</k>_hidden').val(datum.ID);
    }).on('typeahead:asyncrequest', function ($e, datum)
    {
    })
    .on('typeahead:asyncreceive', function ($e, datum)
    {
    });
</jsrun>