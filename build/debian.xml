<project name="debian" default="debian">
    <taskdef name="phpdeb" classname="phing.tasks.my.PHPDebTask"/>

    <!-- Stubs -->
    <property name="description" value=""/>
    <property name="homepage" value=""/>
    <property name="maintainer" value=""/>

    <!-- Source directories -->
    <property name="source-code" value="src"/>
    <property name="source-docs" value="docs"/>
    <property name="source-etc" value="etc"/>

    <!-- Build directories -->
    <property name="distribution" value="distribution"/>

    <property name="destination-etc" value="etc"/>
    <property name="destination-source" value="var/www" />
    <property name="destination-documents" value="usr/share/doc"/>

    <target name="folders">
        <mkdir dir="${package}/DEBIAN"/>
    </target>

    <target name="control">
        <copy todir="${package}/DEBIAN">
            <fileset dir="build/debian/">
                <include name="*/**"/>
            </fileset>
        </copy>
        <phpdeb name="${phing.project.name}-${env.branch}"
                version="${release}"
                maintainer="${maintainer}"
                description="${description}"
                depends="php5-fpm (>= 5.4) | php5-cli (>= 5.4)"
                homepage="${homepage}"
                provides="${phing.project.name}"
                filename="${package}/DEBIAN/control"
                />
    </target>

    <target name="source">
        <mkdir dir="${package}/${destination-source}/Codeine"/>
        <copy todir="${package}/${destination-source}/Codeine">
            <fileset dir="${source-code}">
                <include name="*/**"/>
            </fileset>
        </copy>
    </target>

    <target name="docs" depends="folders">
        <mkdir dir="${package}/${destination-documents}/${phing.project.name}/"/>
        <copy todir="${package}/${destination-documents}/${phing.project.name}/">
            <fileset dir="${source-docs}">
                <include name="*/**"/>
            </fileset>
        </copy>
    </target>

    <target name="version" depends="folders">
        <echo file="${package}/${destination-source}/Codeine/Options/Version.json" append="false">
{
    "Codeine":
    {
        "Major": "${version}",
        "Minor": ${env.build}
    }
}
        </echo>
    </target>

    <target name="debian" depends="folders, control, source, docs, version">
        <exec command="dpkg --build '${package}' ${distribution}/ " dir="." output="true" />
        <delete dir="${package}" includeemptydirs="true" failonerror="true" />
    </target>
</project>